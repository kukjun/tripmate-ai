# 대화 플로우 예시

## 1. Phase 1: Single Agent 대화

### 시나리오: 오사카 3박4일 여행

---

#### Turn 1: 시작

**User:**
```
안녕하세요
```

**Assistant:**
```
안녕하세요! 여행 계획을 도와드리겠습니다. 어디로 여행 가고 싶으세요?
```

**State:**
```json
{
  "destination": null,
  "current_step": "collecting",
  "messages": [
    {"role": "assistant", "content": "안녕하세요! 여행 계획을 도와드리겠습니다..."},
    {"role": "user", "content": "안녕하세요"},
    {"role": "assistant", "content": "어디로 여행 가고 싶으세요?"}
  ]
}
```

---

#### Turn 2: 목적지 입력

**User:**
```
오사카
```

**Assistant:**
```
오사카 좋네요! 일본의 맛집 천국이죠. 몇 박 며칠 계획이신가요?
```

**State (변화):**
```json
{
  "destination": "오사카",  // ✅ 업데이트
  "duration": null
}
```

---

#### Turn 3: 기간 입력

**User:**
```
3박 4일
```

**Assistant:**
```
3박4일이면 오사카를 충분히 즐길 수 있겠네요! 예산은 1인 기준 얼마 정도 생각하고 계세요?
```

**State (변화):**
```json
{
  "destination": "오사카",
  "duration": 3,  // ✅ 업데이트
  "budget": null
}
```

---

#### Turn 4: 예산 입력

**User:**
```
100만원 정도
```

**Assistant:**
```
1인당 100만원이시군요. 몇 분이서 가시나요?
```

**State (변화):**
```json
{
  "duration": 3,
  "budget": 1000000,  // ✅ 업데이트
  "num_people": null
}
```

---

#### Turn 5: 인원 입력

**User:**
```
친구랑 둘이
```

**Assistant:**
```
친구분과 2분이시군요! 어떤 스타일의 여행을 원하세요? 예를 들어 관광, 맛집, 쇼핑, 휴양 등이 있어요.
```

**State (변화):**
```json
{
  "budget": 1000000,
  "num_people": 2,  // ✅ 업데이트
  "travel_style": []
}
```

---

#### Turn 6: 여행 스타일 입력 (정보 수집 완료)

**User:**
```
관광이랑 맛집
```

**Assistant:**
```
완벽해요! 관광과 맛집 위주의 오사카 3박4일 여행 계획을 찾고 있습니다. 잠시만 기다려주세요... ⏳
```

**State (최종):**
```json
{
  "destination": "오사카",
  "duration": 3,
  "budget": 1000000,
  "num_people": 2,
  "travel_style": ["관광", "맛집"],  // ✅ 업데이트
  "info_collected": true,  // ✅ 완료
  "current_step": "searching"  // ✅ 다음 단계로
}
```

---

#### Turn 7: 검색 진행 중 (로딩)

**Assistant (진행 상태 업데이트):**
```
✈️ 항공권 검색 중... (1/3)
```

**State:**
```json
{
  "current_step": "searching",
  "flights_searched": false
}
```

---

**Assistant:**
```
🏨 숙박 검색 중... (2/3)
```

**State:**
```json
{
  "flights_searched": true,
  "flight_options": [
    {"type": "budget", "price": 250000, ...},
    {"type": "standard", "price": 350000, ...},
    {"type": "premium", "price": 500000, ...}
  ],
  "hotels_searched": false
}
```

---

**Assistant:**
```
📅 일정 생성 중... (3/3)
```

---

#### Turn 8: 최종 결과

**Assistant:**
```markdown
# 🎉 오사카 3박4일 여행 계획 완성!

## ✈️ 항공권 옵션

### 💰 저가형 (왕복 25만원/인)
- **항공사**: 티웨이항공
- **가는 편**: 12/20(금) 06:00 → 08:30
- **오는 편**: 12/23(월) 09:00 → 11:30
- **특징**: 새벽 출발이지만 가성비 최고

### 🎯 추천 (왕복 35만원/인)
- **항공사**: 제주항공
- **가는 편**: 12/20(금) 10:00 → 12:30
- **오는 편**: 12/23(월) 14:00 → 16:30
- **특징**: 오전 출발로 첫날 활용도 높음 ⭐

### ✨ 프리미엄 (왕복 50만원/인)
- **항공사**: 대한항공
- **가는 편**: 12/20(금) 11:00 → 13:30
- **오는 편**: 12/23(월) 15:00 → 17:30
- **특징**: 직항 + 기내식 포함

---

## 🏨 숙박 옵션

### 💰 저가형 (1박 4만원, 총 12만원/인)
- **이름**: 게스트하우스 난바
- **위치**: 난바역 도보 5분
- **평점**: 4.2/5.0
- **특징**: 도미토리, 공용 화장실

### 🎯 추천 (1박 8만원, 총 24만원/인)
- **이름**: 호텔 난바 오리엔탈
- **위치**: 도톤보리 도보 3분
- **평점**: 4.5/5.0
- **특징**: 깔끔한 더블룸 ⭐

### ✨ 프리미엄 (1박 15만원, 총 45만원/인)
- **이름**: 힐튼 오사카
- **위치**: 우메다 중심가
- **평점**: 4.8/5.0
- **특징**: 조식 포함, 수영장

---

## 📅 추천 일정

### Day 1 (12/20 금) - 도착 & 난바 탐방
- **10:00** ✈️ 인천공항 출발
- **12:30** 🛬 간사이공항 도착
- **14:00** 🚇 난바역 도착 (공항 리무진)
- **15:00** 🏨 호텔 체크인
- **16:00** 🏯 **오사카성** 방문 (입장료 600엔)
  - 일본 3대 성곽, 전망대에서 시내 조망
- **19:00** 🍜 **도톤보리** 맛집 탐방
  - 이치란 라멘, 타코야키 본가
  - 글리코 간판 사진 필수!

### Day 2 (12/21 토) - 유니버셜 스튜디오 재팬
- **09:00** 🎢 **USJ 입장** (1일권 8,400엔)
- **09:30** 슈퍼 닌텐도 월드 (조기 입장)
- **12:00** 해리포터 구역
- **15:00** 미니언 파크
- **18:00** 워터월드 쇼
- **20:00** 호텔 복귀
- **21:00** 난바 야시장 (저녁 간식)

### Day 3 (12/22 일) - 교토 당일치기
- **08:00** 🚅 JR 오사카역 → 교토역 (편도 560엔)
- **09:30** 🏛️ **후시미 이나리 신사** (무료)
  - 천개의 도리이, 인스타 핫플
- **12:00** 🍵 니시키 시장 (점심)
  - 교토 부엌, 길거리 음식
- **14:00** 🎋 **아라시야마 대나무숲**
  - 대나무 숲길 산책
- **16:00** 🏯 **킨카쿠지(금각사)** (입장료 400엔)
- **18:30** 🚅 교토역 → 오사카역
- **20:00** 오사카 귀환, 자유시간

### Day 4 (12/23 월) - 쇼핑 & 귀국
- **09:00** 🛍️ **신사이바시** 쇼핑
  - 유니클로, 무인양품, 다이소
- **11:00** ☕ 스타벅스 리저브 (오사카성 앞)
- **12:00** 🍱 점심 (구시카츠 다루마)
- **13:00** 🚌 공항 리무진
- **14:00** ✈️ 간사이공항 출발
- **16:30** 🛬 인천공항 도착

---

## 💰 예상 총 비용 (2인 기준)

| 항목 | 금액 |
|------|------|
| 항공권 | 70만원 (35만 × 2) |
| 숙박 | 48만원 (8만 × 3박 × 2인실) |
| 식비 | 40만원 (2만원/끼 × 3끼 × 4일) |
| 교통 | 15만원 (JR패스, 지하철) |
| 관광 | 20만원 (USJ 티켓 등) |
| 쇼핑/기타 | 7만원 |
| **총합** | **200만원** |

예산(200만원) 딱 맞춤! ✅

---

## 💡 여행 팁

1. **교통카드**: ICOCA 카드 구매 (편의점에서 충전)
2. **USJ 팁**: 익스프레스 패스 미리 구매 (대기시간 단축)
3. **환전**: 1인당 5만엔 정도 권장
4. **통신**: 포켓WiFi 대여 또는 esim
5. **날씨**: 12월 오사카 평균 8-12도 (가벼운 패딩)

어떠세요? 마음에 드시나요? 😊
```

**State (최종 완료):**
```json
{
  "destination": "오사카",
  "duration": 3,
  "budget": 1000000,
  "num_people": 2,
  "travel_style": ["관광", "맛집"],
  "info_collected": true,
  "current_step": "done",  // ✅ 완료
  "flight_options": [...],
  "hotel_options": [...],
  "itinerary": {...}
}
```

---

## 2. Phase 2: Multi Agent 대화

### 시나리오: 방콕 5박6일 럭셔리 여행

---

#### Turn 1-6: 정보 수집 (Phase 1과 동일)

**State (정보 수집 완료):**
```json
{
  "destination": "방콕",
  "duration": 5,
  "budget": 2000000,
  "num_people": 2,
  "travel_style": ["휴양", "맛집"],
  "budget_flexibility": "flexible",  // ✅ Phase 2 추가 정보
  "preferred_airline": "대한항공",
  "accommodation_preference": "hotel",
  "must_visit_places": ["왓 아룬", "수상시장"]
}
```

---

#### Turn 7: Multi Agent 진행 (사용자는 진행 상황 확인)

**Assistant:**
```
🤖 전문가 팀이 최적의 여행을 찾고 있습니다...

✅ Needs Collector: 정보 수집 완료
🔄 Router: 항공 & 숙박 전문가에게 배정 중...
```

**Assistant:**
```
✈️ Flight Expert: 항공권 분석 중...
🏨 Hotel Expert: 숙박 분석 중...
(병렬 실행)
```

**Assistant:**
```
✅ Flight Expert: 3개 옵션 분석 완료
   → 추천: 대한항공 (선호 항공사 반영)

✅ Hotel Expert: 5성급 호텔 3곳 선별 완료
   → 추천: 방콕 메리어트 (수쿰빗)
```

**Assistant:**
```
📅 Itinerary Planner: 5일 일정 최적화 중...
   → 동선 효율: 92%

💰 Budget Manager: 예산 분배 중...
   → 총 예산: 400만원 (2인)
   → 여유 자금: 40만원
```

**Assistant:**
```
🎯 Final Coordinator: 3가지 플랜 생성 중...
```

---

#### Turn 8: 최종 결과 (3가지 플랜)

**Assistant:**
```markdown
# 🎉 방콕 5박6일 완벽 가이드

당신의 예산: 400만원 (2인)
여행 스타일: 휴양 + 맛집

---

## 📊 3가지 추천 플랜

### 🌟 플랜 A: 럭셔리 휴양 (550만원)
완벽한 휴식과 프리미엄 경험

**항공**: 대한항공 비즈니스 (150만원)
**숙박**: 만다린 오리엔탈 방콕 (1박 50만원)
**특징**:
- 짜오프라야 강변 5성급
- 스파 & 미슐랭 레스토랑
- 프라이빗 보트 투어

[상세 일정 보기]

---

### ⭐ 플랜 B: 프리미엄 밸런스 (400만원) 👈 추천!
품질과 가성비의 완벽한 균형

**항공**: 대한항공 이코노미 (80만원)
**숙박**: 방콕 메리어트 수쿰빗 (1박 25만원)
**특징**:
- BTS 직결, 교통 편리
- 루프탑 바 & 인피니티 풀
- 왓 아룬, 수상시장 투어 포함

**일정 하이라이트:**
- Day 1: 도착 & 수쿰빗 탐방
- Day 2: 왓 아룬 + 왕궁 (필수 방문지)
- Day 3: 수상시장 투어
- Day 4: 마사지 & 휴양
- Day 5: 쇼핑 (센트럴 월드)
- Day 6: 조식 후 귀국

[상세 일정 보기]

---

### 💰 플랜 C: 가성비 여행 (280만원)
저예산으로 알차게

**항공**: 에어아시아 (40만원)
**숙박**: 부티크 호텔 (1박 12만원)
**특징**:
- 가성비 숙소 & 로컬 맛집
- 대중교통 이용
- 필수 투어만 선택

[상세 일정 보기]

---

## 💡 전문가 추천 (Final Coordinator)

**플랜 B를 강력 추천합니다!**

**이유:**
1. ✅ 예산 400만원에 딱 맞춤
2. ✅ 대한항공 선호 반영
3. ✅ 왓 아룬, 수상시장 필수 방문지 포함
4. ✅ 휴양 + 맛집 밸런스 완벽

**플랜 A vs B 비교:**
- 150만원 추가 시 얻는 것:
  - 비즈니스 좌석 (편안함 ↑)
  - 더 좋은 호텔 (만다린)
- 하지만 체감 만족도는 30% 정도만 증가
- **결론**: 가성비 떨어짐

**플랜 C vs B 비교:**
- 120만원 절약하지만:
  - 에어아시아 (좌석 좁음, 짐 추가 요금)
  - 부티크 호텔 (편의시설 부족)
  - 투어 제한적
- **결론**: 120만원 차이 대비 불편함 큼

---

## 🤖 전문가 인사이트

### ✈️ Flight Expert
> "대한항공 이코노미가 최적입니다. 선호 항공사이고, 
> 짐 2개 무료, 기내식 포함으로 에어아시아 대비 
> 실질 가격 차이는 20만원 정도입니다."

### 🏨 Hotel Expert
> "수쿰빗 위치는 교통 최고! BTS 직결로 관광지 접근 쉽고,
> 주변에 맛집 천국. 왕궁 가려면 BTS 타고 30분이면 도착."

### 📅 Itinerary Planner
> "5박이면 방콕을 충분히 즐길 수 있습니다. 
> 동선 최적화로 이동 시간 최소화했고, 
> Day 4는 휴식 날로 배정해 여유롭게 즐기세요."

### 💰 Budget Manager
> "총 예산 400만원에서 360만원 사용 예정.
> 40만원 여유 자금은 쇼핑이나 추가 마사지에 활용하세요.
> 환전은 1인당 2만바트(80만원) 권장."

---

어떤 플랜이 마음에 드시나요? 😊
```

---

## 3. 예외 상황 처리

### 3.1 예산 부족

**User:**
```
예산은 50만원이에요
```

**Assistant:**
```
❗ 예산이 조금 부족할 수 있어요.

오사카 3박4일 최소 예산:
- 항공권: 25만원 (저가 항공)
- 숙박: 12만원 (게스트하우스)
- 식비/교통: 15만원
**최소: 약 52만원**

50만원으로도 가능하지만 매우 빡빡합니다.

옵션:
1. 예산을 70만원으로 올리기 (권장)
2. 50만원으로 도전 (숙박 다운그레이드)
3. 기간을 2박3일로 줄이기

어떻게 하시겠어요?
```

---

### 3.2 API 실패

**Assistant (내부 오류 발생):**
```
⚠️ 항공권 정보를 가져오는 중 문제가 발생했습니다.

다시 시도 중입니다... (2/3)
```

**Assistant (재시도 실패):**
```
😔 죄송합니다. 현재 항공권 정보를 가져올 수 없습니다.

추천:
1. 네이버 항공권에서 직접 검색: naver.com/flights
2. 잠시 후 다시 시도

숙박과 일정은 계속 진행할까요?
```

---

### 3.3 모호한 입력

**User:**
```
일본
```

**Assistant:**
```
일본 여행이시군요! 일본 어느 도시를 생각하고 계세요?

인기 도시:
- 오사카 (맛집, 쇼핑)
- 도쿄 (다양한 경험)
- 후쿠오카 (가까움, 온천)
- 삿포로 (자연, 눈)

또는 여러 도시를 돌고 싶으신가요?
```

---

## 4. 대화 스타일 가이드

### 친근하고 자연스럽게

❌ **나쁜 예:**
```
목적지를 입력하세요.
```

✅ **좋은 예:**
```
어디로 여행 가고 싶으세요? 😊
```

---

### 맥락 유지

❌ **나쁜 예:**
```
예산을 입력하세요.
```

✅ **좋은 예:**
```
오사카 3박4일이면 딱 좋네요! 예산은 1인 기준 얼마 정도 생각하세요?
```

---

### 적절한 이모지 사용

✅ **좋은 예:**
```
✈️ 항공권 검색 중...
🏨 숙박 검색 중...
📅 일정 생성 중...
```

---

**문서 버전**: 1.0  
**작성일**: 2024-11-30  
**관련 문서**: phase1-requirements.md, agent-design.md